<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header('Результаты теста')}">
<body>
<div th:replace="~{fragments/navigation}"></div>

<div class="container py-3 py-md-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <!-- Заголовок -->
            <div class="text-center mb-4">
                <i class="bi bi-trophy-fill text-warning display-1"></i>
                <h1 class="mt-3 h3 h2-md">Тест завершен!</h1>
                <p class="lead text-muted small" th:text="${results.testTitle}">Название теста</p>
            </div>

            <!-- Результат -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-3 p-md-4 text-center">
                    <div class="display-1 fw-bold mb-3 h1 display-md-1" th:text="${results.correctAnswers} + '/' + ${results.totalQuestions}">
                        5/10
                    </div>

                    <div class="mb-3">
                        <div class="progress" style="height: 15px;">
                            <div class="progress-bar bg-dark" role="progressbar"
                                 th:style="'width: ' + ${results.percentage} + '%'"
                                 th:attr="aria-valuenow=${results.percentage}" aria-valuemin="0" aria-valuemax="100">
                                <span class="small" th:text="${results.percentage} + '%'">50%</span>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-6">
                            <div class="border-end">
                                <span class="text-muted d-block small">Правильных</span>
                                <span class="h3 text-success mb-0 h4 h3-md" th:text="${results.correctAnswers}">5</span>
                            </div>
                        </div>
                        <div class="col-6">
                            <span class="text-muted d-block small">Неправильных</span>
                            <span class="h3 text-danger mb-0 h4 h3-md" th:text="${results.totalQuestions - results.correctAnswers}">5</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Детали по вопросам -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-2">
                    <h5 class="mb-0 h6 h5-md">Детали по вопросам</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div th:each="question, stat : ${results.questionResults}" class="list-group-item p-3">
                            <div class="d-flex">
                                <div class="me-2 me-md-3">
                                    <i class="bi fs-5" th:classappend="${question.isCorrect} ? 'bi-check-circle-fill text-success' : 'bi-x-circle-fill text-danger'"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-2 fw-semibold small" th:text="${stat.count} + '. ' + ${question.questionText}">
                                        1. Текст вопроса
                                    </p>
                                    <div class="small">
                                        <div class="mb-1">
                                            <span class="text-muted small">Ваш ответ: </span>
                                            <span th:classappend="${question.isCorrect} ? 'text-success' : 'text-danger'"
                                                  th:text="${question.chosenAnswerText} ?: 'Не отвечен'">
                                                Вариант
                                            </span>
                                        </div>
                                        <div th:if="${!question.isCorrect and question.correctAnswerText != null}">
                                            <span class="text-muted small">Правильный: </span>
                                            <span class="text-success small" th:text="${question.correctAnswerText}">
                                                Правильный вариант
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Кнопки действий -->
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                <a th:href="@{/tester/dashboard}" class="btn btn-outline-secondary btn-sm flex-fill flex-sm-grow-0">
                    <i class="bi bi-speedometer2 me-2"></i>Дашборд
                </a>
                <a th:href="@{/tester/history}" class="btn btn-outline-dark btn-sm flex-fill flex-sm-grow-0">
                    <i class="bi bi-clock-history me-2"></i>История
                </a>
                <a th:href="@{/tester/catalog}" class="btn btn-dark btn-sm flex-fill flex-sm-grow-0">
                    <i class="bi bi-grid me-2"></i>Другие тесты
                </a>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>